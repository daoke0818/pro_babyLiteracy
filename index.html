<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <title>阿洛识字</title>
    <meta name="keywords" content="关中刀客在青岛,个人博客,前端技术博客">
    <meta name="description" content="一款宝宝识字的web应用">
    <link rel="stylesheet" href="static/assets/css/bootstrap-4.3.1.min.css">
    <script src="static/assets/js/jquery-3.3.1.min.js"></script>
    <style>
        body {
            background-color: skyblue;
        }

        body > .container > section {
            margin-bottom: 2em;
        }

        .jumbotron {
            background-color: pink;
            margin-bottom: 1rem;
            padding: 1rem;
            overflow: hidden;
        }

        .jumbotron h2 {
            font-size: 1.75rem;
            color: #fff;
        }

        .box-wrap > div {
            width: 33%;
            height: 6rem;
            line-height: 6rem;
            font-size: 4rem;
            font-weight: bold;
            border: .125rem solid gray;
            background: lightgray;
            cursor: pointer;
        }

        .box-wrap > div.correct {
            color: #fff;
            background: limegreen;
        }

        .box-wrap > div.error {
            background: indianred;
        }

        .box-wrap ~ img {
            display: none;
            top: 57%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #answer {
            color: rgba(0, 0, 0, .1);
        }

        #next {
            width: 100%;
        }
    </style>
</head>

<body id="investmentRisk">
<div id="container">
    <div class="container">
        <div class="jumbotron">
            <h2 class="text-center">阿洛加油<br>
                <small>ヾ(◍°∇°◍)ﾉﾞ</small>
            </h2>
            <div class="input-group justify-content-end">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1"
                           value="number">
                    <label class="form-check-label" for="inlineRadio1">数字</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2"
                           value="letter">
                    <label class="form-check-label" for="inlineRadio2">大写字母</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio4"
                           value="letterOrNum" checked>
                    <label class="form-check-label" for="inlineRadio4">大写字母或数字</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3"
                           value="other" disabled>
                    <label class="form-check-label" for="inlineRadio3">其他符号</label>
                </div>
                <div class="ml-3">
                    <output id="answer"></output>
                </div>
            </div>
        </div>
        <section class="text-center mb-2 position-relative">
            <p class="mb-2">请点击答案方格：</p>
            <div class="box-wrap d-flex flex-wrap">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <img src="static/img/thumb1.jpg" id="good" class="position-absolute w-50"
                 data-src="thumb1.jpg,thumb2,thumb3_face" alt="thumb">
        </section>
        <p>第
            <output id="counter" class="font-weight-bold"></output>
            道题
        </p>
        <p id="tip"></p>
        <!--
                <p class="text-center">
                    <button class="btn btn-primary" id="next">下一题</button>
                </p>
        -->
    </div>
</div>
<audio id="sound_correct" hidden src="static/sound/tada.wav"></audio>
<audio id="sound_next" hidden src="static/sound/next.wav"></audio>
<script>
    $(function () {
        const $blocks = $('.box-wrap>div');
        const $sound_correct = $('#sound_correct');
        const $sound_next = $('#sound_next');
        const $good = $('#good');
        const $tip = $('#tip');
        const limitNum = 20;
        const thumbs = ['thumb1.jpg', 'thumb2.jpg', 'thumb3_face.jpg'];
        const passLetters = ['A', 'B', 'C', 'E', 'K', 'L', 'M', 'O', 'Q', 'R', 'S', 'W', 'X', 'Y', 'Z'];
        let result = '';
        let counter = 1;
        let resultIndex = 0;
        let timer = 0;
        let type = 'number';

        const rdm_num = () => Math.floor(Math.random() * 10) + '';
        const rdm_letter = () => {
            let result;
            while (true) {
                result = String.fromCharCode(Math.floor(Math.random() * 26) + 65);
                if (passLetters.includes(result)) { break;}
            }
            return result;
        };
        const shuffle = () => {
            const thumbAttr = 'static/img/' + thumbs[Math.floor(Math.random() * thumbs.length)];
            $good.hide().attr('src', thumbAttr);
            timer = null;
            $blocks.removeClass('correct error');
            switch (type) {
                case "number":
                    result = rdm_num();
                    $tip.hide();
                    break;
                case 'letter': //大写字母的ASC2码是65~90
                    result = rdm_letter();
                    $tip.html('目前已经学过的字母有：<br>' + passLetters.join(' ') + '<br>共' + passLetters.length + '个').show();
                    break;
                case 'letterOrNum':
                    result = Math.random()<.5?rdm_letter():rdm_num();
            }
            resultIndex = Math.floor(Math.random() * 10);
            let rdmStr = '';
            while (true) {
                rdmStr = Math.random().toString(36).toUpperCase().substr(-8).split('');
                if (!rdmStr.includes(result)) {
                    break;
                }
            }
            rdmStr.splice(resultIndex, 0, result + '');
            // console.log(result,resultIndex,rdmStr);
            $blocks.each(function (index, item, self) {
                $(item).text(rdmStr[index])
            });
            $('#answer').text(result);
            $('#counter').text(counter);
        };

        $('[name=inlineRadioOptions]').change(function () {
            type = $(this).val();
            shuffle();
        }).filter(':checked').change();


        function checkRight() {
            setTimeout(function () {
                $good.show(100)
            }, 400);

            $blocks.eq(resultIndex).addClass('correct');
            $sound_correct.get(0).pause();
            $sound_correct.get(0).play();
            timer = setTimeout(next, 1500);
        }

        $blocks.click(function () {
            let text = $(this).text();
            if (!timer && text === result) {
                checkRight()
            } else {
                // $(this).addClass('error')
            }

        });
        $('body').keyup(function (e) {
            if (!timer && e.key === result) {
                checkRight()
            }
        });

        let next = () => {
            $blocks.css('pointer-events', 'initial');
            $sound_next.get(0).pause();
            $sound_next.get(0).play();
            if (++counter > limitNum) {
                alert('宝宝，你已经学了' + limitNum + '道题了，该休息一下眼睛了！');
                $('#next').text('休息了');
                close(); // 移动端不好用，PC端有时不好用
                $('body').css('pointer-events', 'none');
                return;
            }
            shuffle();
        }
        /*$('#next').click(function () {

        })*/
    })
</script>
</body>
</html>

<!--/usr/local/apache-tomcat-9.0.16/webapps/ROOT/projects/babyLiteracy-->





